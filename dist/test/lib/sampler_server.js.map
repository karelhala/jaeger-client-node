{"version":3,"sources":["../../../test/lib/sampler_server.js"],"names":["SamplingServer","port","_port","_app","_strategies","Object","create","get","_handle","bind","serviceName","response","req","res","service","query","strategy","send","status","err","_server","listen","close"],"mappings":";;;;;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;IAEqBA,c;AAMjB,8BAAiC;AAAA,YAArBC,IAAqB,uEAAN,IAAM;;AAAA;;AAC7B,aAAKC,KAAL,GAAaD,IAAb;AACA,aAAKE,IAAL,GAAY,wBAAZ;AACA,aAAKC,WAAL,GAAmBC,OAAOC,MAAP,CAAc,IAAd,CAAnB;AACA,aAAKH,IAAL,CAAUI,GAAV,CAAc,WAAd,EAA2B,KAAKC,OAAL,CAAaC,IAAb,CAAkB,IAAlB,CAA3B;AACH;;;;oCAEWC,W,EAAqBC,Q,EAA0C;AACvE,iBAAKP,WAAL,CAAiBM,WAAjB,IAAgCC,QAAhC;AACH;;;0CAEuB;AACpB,iBAAKP,WAAL,GAAmBC,OAAOC,MAAP,CAAc,IAAd,CAAnB;AACH;;;gCAEOM,G,EAAUC,G,EAAU;AACxB,gBAAIC,UAAUF,IAAIG,KAAJ,CAAUD,OAAxB;AACA,gBAAIE,WAAW,KAAKZ,WAAL,CAAiBU,OAAjB,CAAf;AACA,gBAAIE,QAAJ,EAAc;AACVH,oBAAII,IAAJ,CAASD,QAAT;AACH,aAFD,MAEO;AACHH,oBAAIK,MAAJ,CAAW,GAAX,EAAgBD,IAAhB,CAAqB,EAACE,iCAA8BL,OAA9B,OAAD,EAArB;AACH;AACJ;;;gCAEuB;AACpB,iBAAKM,OAAL,GAAe,KAAKjB,IAAL,CAAUkB,MAAV,CAAiB,KAAKnB,KAAtB,CAAf;AACA,mBAAO,IAAP;AACH;;;gCAEa;AACV,iBAAKkB,OAAL,CAAaE,KAAb;AACH;;;;;;kBAtCgBtB,c","file":"sampler_server.js","sourcesContent":["// @flow\n// Copyright (c) 2016 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport express from 'express';\n\nexport default class SamplingServer {\n    _port: number;\n    _app: any;\n    _server: any;\n    _strategies: { [service: string]: SamplingStrategyResponse };\n\n    constructor(port: number = 5778) {\n        this._port = port;\n        this._app = express();\n        this._strategies = Object.create(null);\n        this._app.get('/sampling', this._handle.bind(this));\n    }\n\n    addStrategy(serviceName: string, response: SamplingStrategyResponse): void {\n        this._strategies[serviceName] = response;\n    }\n\n    clearStrategies(): void {\n        this._strategies = Object.create(null);\n    }\n\n    _handle(req: any, res: any) {\n        let service = req.query.service;\n        let strategy = this._strategies[service];\n        if (strategy) {\n            res.send(strategy);\n        } else {\n            res.status(404).send({err: `unknown service name '${service}'`});\n        }\n    }\n\n    start(): SamplingServer {\n        this._server = this._app.listen(this._port);\n        return this;\n    }\n\n    close(): void {\n        this._server.close();\n    }\n}\n"]}