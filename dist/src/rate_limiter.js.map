{"version":3,"sources":["../../src/rate_limiter.js"],"names":["RateLimiter","creditsPerSecond","maxBalance","_creditsPerSecond","_balance","_maxBalance","_lastTick","Date","getTime","itemCost","currentTime","elapsedTime"],"mappings":";;;;;;;;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;IAEqBA,W;AAMjB,yBAAYC,gBAAZ,EAAsCC,UAAtC,EAA0D;AAAA;;AACtD,aAAKC,iBAAL,GAAyBF,gBAAzB;AACA,aAAKG,QAAL,GAAgBF,UAAhB;AACA,aAAKG,WAAL,GAAmBH,UAAnB;AACA,aAAKI,SAAL,GAAiB,IAAIC,IAAJ,GAAWC,OAAX,EAAjB;AACH;;;;oCAEWC,Q,EAA2B;AACnC,gBAAIC,cAAsB,IAAIH,IAAJ,GAAWC,OAAX,EAA1B;AACA,gBAAIG,cAAsB,CAACD,cAAc,KAAKJ,SAApB,IAAiC,IAA3D;AACA,iBAAKA,SAAL,GAAiBI,WAAjB;;AAEA,iBAAKN,QAAL,IAAiBO,cAAc,KAAKR,iBAApC;AACA,gBAAI,KAAKC,QAAL,GAAgB,KAAKC,WAAzB,EAAsC;AAClC,qBAAKD,QAAL,GAAgB,KAAKC,WAArB;AACH;AACD,gBAAI,KAAKD,QAAL,IAAiBK,QAArB,EAA+B;AAC3B,qBAAKL,QAAL,IAAiBK,QAAjB;AACA,uBAAO,IAAP;AACH;AACD,mBAAO,KAAP;AACH;;;;;;kBA3BgBT,W","file":"rate_limiter.js","sourcesContent":["// @flow\n// Copyright (c) 2016 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nexport default class RateLimiter {\n    _creditsPerSecond: number;\n    _balance: number;\n    _maxBalance: number;\n    _lastTick: number;\n\n    constructor(creditsPerSecond: number, maxBalance: number) {\n        this._creditsPerSecond = creditsPerSecond;\n        this._balance = maxBalance;\n        this._maxBalance = maxBalance;\n        this._lastTick = new Date().getTime();\n    }\n\n    checkCredit(itemCost: number): boolean {\n        let currentTime: number = new Date().getTime();\n        let elapsedTime: number = (currentTime - this._lastTick) / 1000;\n        this._lastTick = currentTime;\n\n        this._balance += elapsedTime * this._creditsPerSecond;\n        if (this._balance > this._maxBalance) {\n            this._balance = this._maxBalance;\n        }\n        if (this._balance >= itemCost) {\n            this._balance -= itemCost;\n            return true;\n        }\n        return false;\n    }\n}\n"]}