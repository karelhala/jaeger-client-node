{"version":3,"sources":["../../test/thrift.js"],"names":["_chai","require","_const_sampler","_const_sampler2","_interopRequireDefault","_in_memory_reporter","_in_memory_reporter2","_tracer","_tracer2","_thrift","_thrift2","_util","_util2","obj","__esModule","default","describe","it","blob","Buffer","testCases","vType","vDouble","vBool","vBinary","vStr","x","f","forEach","testCase","tag","actualTag","getThriftTags","expectedTag","key","undefined","vLong","emptyBuffer","assert","deepEqual","buf","fill","reporter","tracer","span","startSpan","startTime","log","event","finish","close","tSpan","spanToThrift","encodeInt64","duration","logs","timestamp"],"mappings":"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","file":"thrift.js","sourcesContent":["'use strict';\n\nvar _chai = require('chai');\n\nvar _const_sampler = require('../src/samplers/const_sampler.js');\n\nvar _const_sampler2 = _interopRequireDefault(_const_sampler);\n\nvar _in_memory_reporter = require('../src/reporters/in_memory_reporter.js');\n\nvar _in_memory_reporter2 = _interopRequireDefault(_in_memory_reporter);\n\nvar _tracer = require('../src/tracer.js');\n\nvar _tracer2 = _interopRequireDefault(_tracer);\n\nvar _thrift = require('../src/thrift.js');\n\nvar _thrift2 = _interopRequireDefault(_thrift);\n\nvar _util = require('../src/util.js');\n\nvar _util2 = _interopRequireDefault(_util);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// Copyright (c) 2016 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\ndescribe('ThriftUtils', function () {\n    it('should exercise all paths in getTagType', function () {\n        var blob = new Buffer(1);\n        var testCases = [{ 'key': 'double', 'value': 1.0, vType: 'DOUBLE', vDouble: 1.0 }, { 'key': 'boolean', 'value': true, vType: 'BOOL', vBool: true }, { 'key': 'binary', 'value': blob, vType: 'BINARY', vBinary: blob }, { 'key': 'string', 'value': 'some-string', vType: 'STRING', vStr: 'some-string' }, { 'key': 'object', 'value': { x: 'y' }, vType: 'STRING', vStr: '{\"x\":\"y\"}' }, { 'key': 'func', 'value': function f() {}, vType: 'STRING', vStr: 'function f() {}' }];\n\n        testCases.forEach(function (testCase) {\n            var tag = { 'key': testCase['key'], 'value': testCase['value'] };\n            var actualTag = _thrift2.default.getThriftTags([tag])[0];\n            var expectedTag = {\n                key: testCase.key,\n                vType: testCase.vType,\n                vStr: testCase.vStr === undefined ? '' : testCase.vStr,\n                vDouble: testCase.vDouble === undefined ? 0 : testCase.vDouble,\n                vBool: testCase.vBool === undefined ? false : testCase.vBool,\n                vLong: testCase.vLong === undefined ? _thrift2.default.emptyBuffer : testCase.vLong,\n                vBinary: testCase.vBinary === undefined ? _thrift2.default.emptyBuffer : testCase.vBinary\n            };\n            _chai.assert.deepEqual(actualTag, expectedTag);\n        });\n    });\n\n    it('should initialize emptyBuffer to all zeros', function () {\n        var buf = new Buffer(8);\n        buf.fill(0);\n\n        _chai.assert.deepEqual(_thrift2.default.emptyBuffer, buf);\n    });\n\n    it('should convert timestamps to microseconds', function () {\n        var reporter = new _in_memory_reporter2.default();\n        var tracer = new _tracer2.default('test-service-name', reporter, new _const_sampler2.default(true));\n        var span = tracer.startSpan('some operation', { startTime: 123.456 });\n        span.log({ event: 'some log' }, 123.567);\n        span.finish(123.678);\n        tracer.close();\n        var tSpan = _thrift2.default.spanToThrift(span);\n        _chai.assert.deepEqual(tSpan.startTime, _util2.default.encodeInt64(123456));\n        _chai.assert.deepEqual(tSpan.duration, _util2.default.encodeInt64((123.678 - 123.456) * 1000));\n        _chai.assert.deepEqual(tSpan.logs[0].timestamp, _util2.default.encodeInt64(123567));\n    });\n});\n//# sourceMappingURL=thrift.js.map"]}