{"version":3,"sources":["../../test/text_map_codec.js"],"names":["_chai","require","_constants","constants","_interopRequireWildcard","_const_sampler","_const_sampler2","_interopRequireDefault","_in_memory_reporter","_in_memory_reporter2","_opentracing","_opentracing2","_tracer","_tracer2","_metrics","_metrics2","_metric_factory","_metric_factory2","_backend","_backend2","obj","__esModule","default","newObj","key","Object","prototype","hasOwnProperty","call","describe","it","metrics","tracer","headers","context","extract","FORMAT_HTTP_HEADERS","assert","isOk","counterEquals","decodingErrors","JAEGER_DEBUG_HEADER","encodeURIComponent","isDebugIDContainerOnly","equal","debugId","span","startSpan","childOf","isNotOk","parentId","traceId","isSampled","isDebug","tagFound","i","_tags","length","tag","value","tracesStartedSampled"],"mappings":"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","file":"text_map_codec.js","sourcesContent":["'use strict';\n\nvar _chai = require('chai');\n\nvar _constants = require('../src/constants.js');\n\nvar constants = _interopRequireWildcard(_constants);\n\nvar _const_sampler = require('../src/samplers/const_sampler.js');\n\nvar _const_sampler2 = _interopRequireDefault(_const_sampler);\n\nvar _in_memory_reporter = require('../src/reporters/in_memory_reporter.js');\n\nvar _in_memory_reporter2 = _interopRequireDefault(_in_memory_reporter);\n\nvar _opentracing = require('opentracing');\n\nvar _opentracing2 = _interopRequireDefault(_opentracing);\n\nvar _tracer = require('../src/tracer.js');\n\nvar _tracer2 = _interopRequireDefault(_tracer);\n\nvar _metrics = require('../src/metrics/metrics.js');\n\nvar _metrics2 = _interopRequireDefault(_metrics);\n\nvar _metric_factory = require('./lib/metrics/local/metric_factory.js');\n\nvar _metric_factory2 = _interopRequireDefault(_metric_factory);\n\nvar _backend = require('./lib/metrics/local/backend.js');\n\nvar _backend2 = _interopRequireDefault(_backend);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\ndescribe('Text Map Codec should', function () {\n    it('report metric when failing to decode tracer state', function () {\n        var metrics = new _metrics2.default(new _metric_factory2.default());\n        var tracer = new _tracer2.default('test-tracer', new _in_memory_reporter2.default(), new _const_sampler2.default(false), {\n            metrics: metrics\n        });\n\n        var headers = {\n            'uber-trace-id': 'bad-value'\n        };\n        var context = tracer.extract(_opentracing2.default.FORMAT_HTTP_HEADERS, headers);\n\n        _chai.assert.isOk(context);\n        _chai.assert.isOk(_backend2.default.counterEquals(metrics.decodingErrors, 1));\n    });\n\n    it('set debug flag when debug-id-header is received', function () {\n        var metrics = new _metrics2.default(new _metric_factory2.default());\n        var tracer = new _tracer2.default('test-tracer', new _in_memory_reporter2.default(), new _const_sampler2.default(false), {\n            metrics: metrics\n        });\n        var headers = {};\n        headers[constants.JAEGER_DEBUG_HEADER] = encodeURIComponent('value1');\n\n        var context = tracer.extract(_opentracing2.default.FORMAT_HTTP_HEADERS, headers);\n        _chai.assert.isOk(context.isDebugIDContainerOnly());\n        _chai.assert.equal(context.debugId, 'value1');\n\n        var span = tracer.startSpan(\"root\", { childOf: context });\n\n        _chai.assert.isNotOk(span.context().parentId);\n        _chai.assert.isOk(span.context().traceId !== 0);\n        _chai.assert.isOk(span.context().isSampled());\n        _chai.assert.isOk(span.context().isDebug());\n\n        var tagFound = false;\n        for (var i = 0; i < span._tags.length; i++) {\n            var tag = span._tags[i];\n            if (tag.key === constants.JAEGER_DEBUG_HEADER && span._tags[i].value === 'value1') {\n                tagFound = true;\n            }\n        }\n\n        _chai.assert.isOk(tagFound);\n\n        // metrics\n        _chai.assert.isOk(_backend2.default.counterEquals(metrics.tracesStartedSampled, 1));\n    });\n}); // Copyright (c) 2016 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n//# sourceMappingURL=text_map_codec.js.map"]}