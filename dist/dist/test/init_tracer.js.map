{"version":3,"sources":["../../test/init_tracer.js"],"names":["_lodash","require","_lodash2","_interopRequireDefault","_chai","_noop_reporter","_noop_reporter2","_composite_reporter","_composite_reporter2","_remote_reporter","_remote_reporter2","_const_sampler","_const_sampler2","_probabilistic_sampler","_probabilistic_sampler2","_remote_sampler","_remote_sampler2","_ratelimiting_sampler","_ratelimiting_sampler2","_index","_opentracing","_opentracing2","obj","__esModule","default","describe","it","config","serviceName","disable","tracer","initTracer","expect","to","be","an","instanceof","Tracer","_sampler","_reporter","options","type","param","expectedType","expectedParam","each","samplerConfig","sampler","count","err","assert","equal","reporter","logSpans","agentHost","agentPort","flushIntervalMs","remoteReporter","i","_reporters","length","_bufferFlushInterval","_sender","_host","_port","logger","info","msg","metrics","createCounter","createGauge","createTimer","tags","_logger","_metrics","_factory","_tags"],"mappings":"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","file":"init_tracer.js","sourcesContent":["'use strict';\n\nvar _lodash = require('lodash');\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _chai = require('chai');\n\nvar _noop_reporter = require('../src/reporters/noop_reporter');\n\nvar _noop_reporter2 = _interopRequireDefault(_noop_reporter);\n\nvar _composite_reporter = require('../src/reporters/composite_reporter');\n\nvar _composite_reporter2 = _interopRequireDefault(_composite_reporter);\n\nvar _remote_reporter = require('../src/reporters/remote_reporter');\n\nvar _remote_reporter2 = _interopRequireDefault(_remote_reporter);\n\nvar _const_sampler = require('../src/samplers/const_sampler');\n\nvar _const_sampler2 = _interopRequireDefault(_const_sampler);\n\nvar _probabilistic_sampler = require('../src/samplers/probabilistic_sampler');\n\nvar _probabilistic_sampler2 = _interopRequireDefault(_probabilistic_sampler);\n\nvar _remote_sampler = require('../src/samplers/remote_sampler');\n\nvar _remote_sampler2 = _interopRequireDefault(_remote_sampler);\n\nvar _ratelimiting_sampler = require('../src/samplers/ratelimiting_sampler');\n\nvar _ratelimiting_sampler2 = _interopRequireDefault(_ratelimiting_sampler);\n\nvar _index = require('../src/index.js');\n\nvar _opentracing = require('opentracing');\n\nvar _opentracing2 = _interopRequireDefault(_opentracing);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\ndescribe('initTracer', function () {\n    it('should initialize noop tracer when disable is set', function () {\n        var config = {\n            serviceName: 'test-service',\n            disable: true\n        };\n        var tracer = (0, _index.initTracer)(config);\n\n        (0, _chai.expect)(tracer).to.be.an.instanceof(_opentracing2.default.Tracer);\n    });\n\n    it('should initialize normal tracer when only service name given', function () {\n        var config = {\n            serviceName: 'test-service'\n        };\n        var tracer = (0, _index.initTracer)(config);\n\n        (0, _chai.expect)(tracer._sampler).to.be.an.instanceof(_remote_sampler2.default);\n        (0, _chai.expect)(tracer._reporter).to.be.an.instanceof(_remote_reporter2.default);\n    });\n\n    it('should initialize proper samplers', function () {\n        var config = {\n            serviceName: 'test-service'\n        };\n        var options = [{ type: 'const', param: 1, expectedType: _const_sampler2.default, expectedParam: 1 }, { type: 'ratelimiting', param: 2, expectedType: _ratelimiting_sampler2.default, expectedParam: 2 }, { type: 'probabilistic', param: 0.5, expectedType: _probabilistic_sampler2.default, expectedParam: 0.5 }, { type: 'remote', param: 1, expectedType: _remote_sampler2.default, expectedParam: 1 }];\n\n        _lodash2.default.each(options, function (samplerConfig) {\n            var expectedType = samplerConfig.expectedType;\n            var expectedParam = samplerConfig.expectedParam;\n            delete samplerConfig.expectedType;\n            delete samplerConfig.expectedParam;\n\n            config.sampler = samplerConfig;\n            var tracer = (0, _index.initTracer)(config);\n\n            (0, _chai.expect)(tracer._sampler).to.be.an.instanceof(expectedType);\n            // TODO(oibe:head) test utils for expectedParam here?\n        });\n    });\n\n    it('should throw error on sampler incorrect type', function () {\n        var config = {\n            serviceName: 'test-service'\n        };\n        var options = [{ type: 'const', param: 'bad-value' }, { type: 'ratelimiting', param: 'bad-value' }, { type: 'probabilistic', param: 'bad-value' }, { type: 'remote', param: 'bad-value' }];\n\n        var count = 0;\n        _lodash2.default.each(options, function (samplerConfig) {\n            config.sampler = samplerConfig;\n\n            // Since its an error from a third party framework, its hard to assert on\n            // using expect.\n            try {\n                (0, _index.initTracer)(config);\n            } catch (err) {\n                count += 1;\n            }\n        });\n\n        _chai.assert.equal(count, 4);\n    });\n\n    it('should respect reporter options', function () {\n        var config = {\n            serviceName: 'test-service',\n            sampler: {\n                type: 'const',\n                param: 0\n            },\n            reporter: {\n                logSpans: true,\n                agentHost: '127.0.0.1',\n                agentPort: 4939,\n                flushIntervalMs: 2000\n            }\n        };\n        var tracer = (0, _index.initTracer)(config);\n\n        (0, _chai.expect)(tracer._reporter).to.be.an.instanceof(_composite_reporter2.default);\n        var remoteReporter = void 0;\n        for (var i = 0; i < tracer._reporter._reporters.length; i++) {\n            var reporter = tracer._reporter._reporters[i];\n            if (reporter instanceof _remote_reporter2.default) {\n                remoteReporter = reporter;\n                break;\n            }\n        }\n\n        _chai.assert.equal(remoteReporter._bufferFlushInterval, 2000);\n        _chai.assert.equal(remoteReporter._sender._host, '127.0.0.1');\n        _chai.assert.equal(remoteReporter._sender._port, 4939);\n    });\n\n    it('should pass options to tracer', function () {\n        var logger = {\n            'info': function info(msg) {}\n        };\n        var metrics = {\n            'createCounter': function createCounter() {\n                return {};\n            },\n            'createGauge': function createGauge() {\n                return {};\n            },\n            'createTimer': function createTimer() {\n                return {};\n            }\n        };\n        var tracer = (0, _index.initTracer)({\n            serviceName: 'test-service'\n        }, {\n            logger: logger,\n            metrics: metrics,\n            tags: {\n                'x': 'y'\n            }\n        });\n        _chai.assert.equal(tracer._logger, logger);\n        _chai.assert.equal(tracer._metrics._factory, metrics);\n        _chai.assert.equal(tracer._tags['x'], 'y');\n    });\n}); // Copyright (c) 2016 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n//# sourceMappingURL=init_tracer.js.map"]}